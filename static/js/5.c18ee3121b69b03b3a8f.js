webpackJsonp([5],{gsrS:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("NYxO"),n={name:"Manage",data:function(){return{loading:!1,hostIpt:"",indexIpt:"",titleIpt:"",isAddWebsite:!1,isGetCode:!1,code:"",copyRes:"",checkRes:[],checkLoading:[],tmpWebsite:null,tmpId:0,editHostIpt:"",editIndexIpt:"",editTitleIpt:"",isEditWebsite:!1,isDeleteWebsite:!1,pswRules:{oldPsw:[{validator:function(t,e,i){""===e?i(new Error("旧密码不能为空")):i()},trigger:"blur"}],email:[{validator:function(t,e,i){""===e?i(new Error("旧邮箱不能为空")):i()},trigger:"blur"}],newPsw:[{validator:function(t,e,i){e.length<6||e.length>16?i(new Error("密码长度在6-16之间")):/^[\x20-\x7E]*$/.test(e)?i():i(new Error("密码不能包含特殊字符"))},trigger:"blur"}]},pswForm:{oldPsw:"",newPsw:"",email:""}}},computed:Object(s.b)(["currentWebsite","websites","visitor"]),methods:{validateHost:function(t){return!!/^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/.test(t)||(this.$emit("addNotification","域名格式不正确","请输入正确的域名"),!1)},validateIndex:function(t){return!!/^(?=^.{3,255}$)http(s)?:\/\/?(www\.)?[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+(:\d+)*(\/\w+\.\w+)*([\?&]\w+=\w*)*$/.test(t)||(this.$emit("addNotification","首页地址格式不正确","请输入正确的首页地址"),!1)},validateTitle:function(t){return t.length<=20||(this.$emit("addNotification","标题名称不正确","网站名称长度不要超过20"),!1)},submitAddWebsite:function(){var t=this;if(this.validateHost(this.hostIpt)&&this.validateIndex(this.indexIpt)&&this.validateTitle(this.titleIpt)){this.loading=!0;var e={host:this.hostIpt,index_url:this.indexIpt,title:this.titleIpt};this.$store.dispatch("addWebsite",e).then(function(e){t.loading=!1,t.isAddWebsite=!1;var i=t.websites;i.push(e.website),t.$store.commit("setWebsites",i),1===i.length&&t.$store.commit("setCurrentWebsite",i[0]),t.hostIpt="",t.indexIpt="",t.titleIpt="",t.$emit("addNotification","成功","添加成功")}).catch(function(){t.loading=!1,t.$emit("addNotification","错误","添加失败")})}},setCode:function(t){this.code=function(t){return"&lt;script async src=\"http://analytics.wzmxx.com/resources/javascripts/wa.js\"&gt;&lt;/script&gt;\n&lt;script&gt;\n    window.waData = window.waData || [];\n    function waTag(){waData.push(arguments);}\n    waTag('config', '"+t+"');\n&lt;/script&gt;"}(t)},showGetCode:function(){this.isGetCode=!0},hideGetCode:function(){this.isGetCode=!1,this.copyRes=""},copyGetCode:function(){document.querySelector("#code").select(),document.execCommand("copy")?this.copyRes="已复制到剪贴板":this.copyRes="复制失败，请手动复制"},checkAllCode:function(){var t=this,e=function(e){t.$store.dispatch("validateSite",t.websites[e].id).then(function(i){t.$set(t.checkRes,e,"✔"),t.$set(t.checkLoading,e,!0)}).catch(function(i){t.$set(t.checkRes,e,"✖"),t.$set(t.checkLoading,e,!0)})};for(var i in this.websites)e(i)},checkCode:function(t,e){var i=this;this.$set(this.checkLoading,e,!1),this.$store.dispatch("validateSite",t.id).then(function(t){i.$set(i.checkLoading,e,!0),i.$set(i.checkRes,e,"✔")}).catch(function(t){i.$set(i.checkLoading,e,!0),i.$set(i.checkRes,e,"✖")})},showEdit:function(t){this.tmpWebsite=t,this.editHostIpt=t.host,this.editIndexIpt=t.index_url,this.editTitleIpt=t.title,this.isEditWebsite=!0},submitEditWebsite:function(){var t=this;this.validateHost(this.editHostIpt)&&this.validateIndex(this.editIndexIpt)&&this.validateTitle(this.editTitleIpt)&&(this.loading=!0,this.tmpWebsite.host=this.editHostIpt,this.tmpWebsite.index_url=this.editIndexIpt,this.tmpWebsite.title=this.editTitleIpt,this.$store.dispatch("editWebsite",this.tmpWebsite).then(function(e){return t.$store.dispatch("getWebsites")}).then(function(e){t.$emit("addNotification","修改成功"),t.isEditWebsite=!1,t.loading=!1,t.websites.forEach(function(e){e.id===t.currentWebsite.id&&t.$store.commit("setCurrentWebsite",e)})}).catch(function(){}).catch(function(){t.loading=!1,t.$emit("addNotification","修改失败")}))},showDelete:function(t){var e=this;this.$confirm("此操作将永久删除该网站，该网站所有数据将被清除，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.loading=!0,e.$store.dispatch("deleteWebsite",t.config).then(function(i){e.loading=!1;var s=e.websites;s.splice(s.indexOf(t),1),e.$store.commit("setWebsites",s),e.currentWebsite.id===t.id&&(0!==e.websites.length?e.$store.commit("setCurrentWebsite",e.websites[0]):e.$store.commit("setCurrentWebsite",null)),e.$emit("addNotification","删除成功")}).catch(function(){e.loading=!1,e.$emit("addNotification","删除失败")})}).catch(function(){})},submitPswForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;var i={oldPsw:e.pswForm.oldPsw,email:e.pswForm.email,newPsw:e.pswForm.newPsw,username:e.$store.state.user.username};e.$store.dispatch("changePassword",i).then(function(t){e.showUserOperation=!1,e.showSelect=!1,e.selectInfo="全部网站数据",e.$store.commit("clearUser"),e.$emit("addNotification","","密码修改成功，请重新登录"),e.$router.replace("/login")}).catch(function(t){"旧密码错误"===t.message?e.$emit("addNotification","","旧密码错误"):"注册邮箱错误"===t.message?e.$emit("addNotification","","注册邮箱错误"):e.$emit("addNotification","","其他错误")})})},alertWarning:function(t){alert(t)}},watch:{websites:function(){this.checkAllCode()}},mounted:function(){this.$emit("routerTo",3),this.checkAllCode(),waTag("event","管理页面","访问","访问管理页面")}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.isAddWebsite?i("div",{staticClass:"add"},[i("div",{staticClass:"add-wrap "},[i("div",{staticClass:"title"},[i("span",[t._v("新增网站")]),i("span",{on:{click:function(e){t.isAddWebsite=!1}}},[t._v("×")])]),t._v(" "),i("div",{staticClass:"input"},[i("label",{attrs:{for:"hostIpt"}},[t._v("网站域名")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.hostIpt,expression:"hostIpt"}],attrs:{type:"text",id:"hostIpt",placeholder:"请输入网站域名"},domProps:{value:t.hostIpt},on:{input:function(e){e.target.composing||(t.hostIpt=e.target.value)}}})]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"input"},[i("label",{attrs:{for:"indexIpt"}},[t._v("网站首页")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.indexIpt,expression:"indexIpt"}],attrs:{type:"text",id:"indexIpt",placeholder:"请输入网站首页"},domProps:{value:t.indexIpt},on:{input:function(e){e.target.composing||(t.indexIpt=e.target.value)}}})]),t._v(" "),t._m(1),t._v(" "),i("div",{staticClass:"input"},[i("label",{attrs:{for:"titleIpt"}},[t._v("网站名称")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.titleIpt,expression:"titleIpt"}],attrs:{type:"text",id:"titleIpt",placeholder:"请输入网站名称"},domProps:{value:t.titleIpt},on:{input:function(e){e.target.composing||(t.titleIpt=e.target.value)}}})]),t._v(" "),i("div",{staticClass:"button"},[i("button",{staticClass:"sure",on:{click:function(e){t.visitor?t.alertWarning("不能更改演示账号哦～"):t.submitAddWebsite()}}},[t._v("确定")]),t._v(" "),i("button",{staticClass:"cancel",on:{click:function(e){t.isAddWebsite=!1}}},[t._v("取消")])])])]):t._e(),t._v(" "),t.isEditWebsite?i("div",{staticClass:"edit"},[i("div",{staticClass:"edit-wrap "},[i("div",{staticClass:"title"},[i("span",[t._v("修改网站")]),i("span",{on:{click:function(e){t.isEditWebsite=!1}}},[t._v("×")])]),t._v(" "),i("div",{staticClass:"input"},[i("label",{attrs:{for:"editHostIpt"}},[t._v("网站域名")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.editHostIpt,expression:"editHostIpt"}],attrs:{type:"text",id:"editHostIpt",placeholder:"请输入新网站域名"},domProps:{value:t.editHostIpt},on:{input:function(e){e.target.composing||(t.editHostIpt=e.target.value)}}})]),t._v(" "),t._m(2),t._v(" "),i("div",{staticClass:"input"},[i("label",{attrs:{for:"editIndexIpt"}},[t._v("网站首页")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.editIndexIpt,expression:"editIndexIpt"}],attrs:{type:"text",id:"editIndexIpt",placeholder:"请输入网站首页"},domProps:{value:t.editIndexIpt},on:{input:function(e){e.target.composing||(t.editIndexIpt=e.target.value)}}})]),t._v(" "),t._m(3),t._v(" "),i("div",{staticClass:"input"},[i("label",{attrs:{for:"editTitleIpt"}},[t._v("网站名称")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.editTitleIpt,expression:"editTitleIpt"}],attrs:{type:"text",id:"editTitleIpt",placeholder:"请输入网站名称"},domProps:{value:t.editTitleIpt},on:{input:function(e){e.target.composing||(t.editTitleIpt=e.target.value)}}})]),t._v(" "),i("div",{staticClass:"button"},[i("button",{staticClass:"sure",attrs:{disabled:""},on:{click:function(e){t.visitor?t.alertWarning("不能更改演示账号哦～"):t.submitEditWebsite}}},[t._v("确定")]),t._v(" "),i("button",{staticClass:"cancel",on:{click:function(e){t.isEditWebsite=!1}}},[t._v("取消")])])])]):t._e(),t._v(" "),t.isGetCode?i("div",{staticClass:"code"},[i("div",{staticClass:"code-wrap "},[i("div",{staticClass:"title"},[i("span",[t._v("复制代码")]),i("span",{on:{click:t.hideGetCode}},[t._v("×")])]),t._v(" "),i("div",{staticClass:"code-content"},[i("textarea",{attrs:{id:"code",readonly:""},domProps:{innerHTML:t._s(t.code)}})]),t._v(" "),i("div",{staticClass:"info"},[t._v(t._s(t.copyRes))]),t._v(" "),i("div",{staticClass:"button"},[i("button",{staticClass:"copy",on:{click:t.copyGetCode}},[t._v("复制")]),t._v(" "),i("button",{staticClass:"cancel",on:{click:t.hideGetCode}},[t._v("关闭")])])])]):t._e(),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[i("h1",{staticClass:"title"},[t._v("网站管理"),i("a",{staticClass:"add-btn",attrs:{href:"javascript:void(0)"},on:{click:function(e){t.visitor?t.alertWarning("不能更改演示账号哦～"):t.isAddWebsite=!0}}},[t._v("新增网站")])]),t._v(" "),i("table",{staticClass:"manage"},[t._m(4),t._v(" "),i("tbody",t._l(t.websites,function(e,s){return i("tr",{key:e.id},[i("td",[t._v(t._s(e.host))]),t._v(" "),i("td",[t._v(t._s(e.title))]),t._v(" "),i("td",[t._v(t._s(e.index_url))]),t._v(" "),i("td",{directives:[{name:"loading",rawName:"v-loading",value:!t.checkLoading[s],expression:"!checkLoading[index]"}]},[i("span",{style:{color:"✖"===t.checkRes[s]?"darkred":"limegreen"}},[t._v(t._s(t.checkRes[s]))]),t._v(" "),i("a",{attrs:{href:"javascript:void(0)",title:"刷新"},on:{click:function(i){return t.checkCode(e,s)}}},[i("i",{staticClass:"el-icon-refresh"})]),t._v(" "),i("a",{attrs:{href:"javascript:void(0)"},on:{click:function(i){t.setCode(e.config),t.showGetCode()}}},[t._v("获取代码")])]),t._v(" "),i("td",[i("el-button",{attrs:{size:"mini"},on:{click:function(i){t.visitor?t.alertWarning("不能更改演示账号哦～"):t.showEdit(e)}}},[t._v("编辑\n          ")]),t._v(" "),i("el-button",{attrs:{size:"mini",type:"danger",disabled:""},on:{click:function(i){t.visitor?t.alertWarning("不能更改演示账号哦～"):t.showDelete(e)}}},[t._v("删除\n          ")])],1)])}),0)]),t._v(" "),0===t.websites.length?i("p",{staticStyle:{"text-align":"center"}},[t._v("你还没有添加网站，"),i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.isAddWebsite=!0}}},[t._v("添加")]),t._v("以查看我的网站分析。\n    ")]):t._e()]),t._v(" "),i("br")])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"describe"},[e("p",[this._v("1. wzmxx.com 或 wzmxx.com:8080")]),this._v(" "),e("p",[this._v("2. www.wzmxx.com 或 www.wzmxx.com:8080")]),this._v(" "),e("p",[this._v("3. analytics.wzmxx.com 或 analytics.wzmxx.com:8080")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"describe"},[e("p",[this._v("1. http://www.wzmxx.com")]),this._v(" "),e("p",[this._v("2. http://www.wzmxx.com/index.html")]),this._v(" "),e("p",[this._v("3. https://www.wzmxx.com")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"describe"},[e("p",[this._v("1. wzmxx.com 或 wzmxx.com:8080")]),this._v(" "),e("p",[this._v("2. www.wzmxx.com 或 www.wzmxx.com:8080")]),this._v(" "),e("p",[this._v("3. analytics.wzmxx.com 或 analytics.wzmxx.com:8080")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"describe"},[e("p",[this._v("1. http://www.wzmxx.com")]),this._v(" "),e("p",[this._v("2. http://www.wzmxx.com/index.html")]),this._v(" "),e("p",[this._v("3. https://www.wzmxx.com")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",[i("tr",[i("td",[t._v("网站域名")]),t._v(" "),i("td",[t._v("网站名称")]),t._v(" "),i("td",[t._v("网站首页")]),t._v(" "),i("td",[t._v("代码安装状态")]),t._v(" "),i("td",[t._v("操作")])])])}]};var o=i("VU/8")(n,a,!1,function(t){i("uwc5")},"data-v-48d526df",null);e.default=o.exports},uwc5:function(t,e){}});
//# sourceMappingURL=5.c18ee3121b69b03b3a8f.js.map